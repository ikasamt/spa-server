# spa-server

`spa-server` is a lightweight and flexible server written in Go to host Angular Single Page Applications (SPA). It supports serving static files from a `dist` directory, SPA routing, and configuration via a `.env` file. Docker support is included for easy deployment.

---

## Features

- **Static File Hosting**: Hosts files generated by `ng build`.
- **SPA Routing**: Routes all undefined paths to `index.html` for SPA compatibility.
- **Environment Configuration**: Configure port, static file directory, and IP restrictions via `.env`.
- **Docker Ready**: Easily build and deploy using Docker.
- **Proxy Support**: Proxy `/query` path requests to a backend server.

---

## Requirements

- Go 1.16+
- Angular CLI (for building the SPA)
- Docker (optional, for containerized deployment)

---

## Installation

1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd spa-server
   ```

2. Install dependencies:
   ```bash
   go mod tidy
   ```

3. Build the server:
   ```bash
   GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o bin/spa-server
   ```

---

## Usage

### Using the binary

1. Ensure your Angular app is built and the output is in the `dist` directory.

2. Create a `.env` file with the following variables:
   ```env
   PORT=8080
   DIST_DIR=./dist
   ALLOW_REMOTE_IPS=127.0.0.1,192.168.1.1
   PROXY_URL=http://backend-server:3000
   PROXY_PATHS=/api,/query
   ```

3. Start the server:
   ```bash
   ./spa-server
   ```

4. Open your browser and visit `http://localhost:8080`.

### Environment Variables

- `PORT`: The port to host the server. Defaults to `8080`.
- `DIST_DIR`: Path to the directory containing static files. Required.
- `ALLOW_REMOTE_IPS`: Comma-separated list of allowed IPs. Leave empty to allow all IPs.
- `PROXY_URL`: Backend server URL for proxying requests. Optional.
- `PROXY_PATHS`: Comma-separated list of paths to proxy. Defaults to `/query` if not specified.

### Proxy Feature

When `PROXY_URL` is configured, requests to specified paths will be proxied to the backend server. This is useful for API integration while serving the frontend from the same domain.

#### Default behavior:
- If `PROXY_PATHS` is not set, only `/query` paths are proxied

#### Custom paths:
Set `PROXY_PATHS` to specify multiple paths:
```env
PROXY_URL=http://backend-server:3000
PROXY_PATHS=/api,/graphql,/webhooks
```

Examples:
- Request to `http://localhost:8080/api/users` → Proxied to `http://backend-server:3000/api/users`
- Request to `http://localhost:8080/graphql` → Proxied to `http://backend-server:3000/graphql`
- Request to `http://localhost:8080/static/app.js` → Served from local files (not proxied)

Headers and HTTP methods are preserved during proxying.

---

## Docker Deployment

### Build the Docker Image

1. Build the Docker image:
   ```bash
   docker build -t spa-server .
   ```
2. Push
   ```bash
   docker push ikasamt/spa-server
   ```

### Run the Container

1. Start the container:
   ```bash
   docker run -p 8080:8080 --env-file .env spa-server
   ```

2. Access the server at `http://localhost:8080`.

---

## Directory Structure

```plaintext
.
├── Dockerfile
├── .dockerignore
├── .env           # Environment configuration file
├── dist/          # Angular build output
├── go.mod
├── go.sum
├── main.go        # Server code
```

---

## Contributing

1. Fork the repository.
2. Create a new branch for your feature or bugfix.
3. Submit a pull request with a detailed explanation.

---

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

---

## Author

Created by [Your Name].